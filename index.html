<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node-Based Scratch Clone</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #sidebar {
            width: 20%;
            background: #333;
            color: white;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .node-button {
            background: #444;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: grab;
        }
        #editor {
            width: 60%;
            height: 100vh;
            border-right: 2px solid black;
            position: relative;
            background: #f4f4f4;
        }
        .node {
            position: absolute;
            width: 120px;
            background: white;
            border: 1px solid #aaa;
            padding: 10px;
            cursor: grab;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }
        .connector {
            width: 12px;
            height: 12px;
            background: blue;
            border-radius: 50%;
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            border: 2px solid white;
        }
        #stage {
            width: 20%;
            height: 100vh;
            background-color: lightgray;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        #sprite {
            width: 50px;
            height: 50px;
            background-color: red;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        svg {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        path {
            stroke: black;
            stroke-width: 2px;
            fill: none;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="node-button" draggable="true" ondragstart="startDrag(event, 'Move')">Move Node</div>
        <div class="node-button" draggable="true" ondragstart="startDrag(event, 'Rotate')">Rotate Node</div>
        <div class="node-button" draggable="true" ondragstart="startDrag(event, 'Color')">Color Node</div>
    </div>
    <div id="editor" ondragover="event.preventDefault()" ondrop="dropNode(event)">
        <svg id="connections"></svg>
    </div>
    <div id="stage">
        <div id="sprite"></div>
    </div>

    <script>
        let nodeId = 0;
        let draggingNode = null;
        let connectingNode = null;

        function startDrag(event, type) {
            event.dataTransfer.setData("nodeType", type);
        }

        function dropNode(event) {
            event.preventDefault();
            const type = event.dataTransfer.getData("nodeType");
            if (!type) return;

            const node = document.createElement("div");
            node.className = "node";
            node.innerText = type + " Node";
            node.style.left = event.clientX + "px";
            node.style.top = event.clientY + "px";
            node.setAttribute("data-id", nodeId++);

            const connector = document.createElement("div");
            connector.className = "connector";
            connector.onclick = () => startConnection(node);

            node.appendChild(connector);
            node.onmousedown = (e) => dragNode(e, node);
            document.getElementById("editor").appendChild(node);
        }

        function dragNode(event, node) {
            event.preventDefault();
            draggingNode = node;
            document.onmousemove = moveNode;
            document.onmouseup = () => {
                draggingNode = null;
                document.onmousemove = null;
            };
        }

        function moveNode(event) {
            if (!draggingNode) return;
            draggingNode.style.left = event.clientX + "px";
            draggingNode.style.top = event.clientY + "px";
            updateAllConnections();
        }

        function startConnection(node) {
            if (!connectingNode) {
                connectingNode = node;
            } else {
                createConnection(connectingNode, node);
                connectingNode = null;
            }
        }

        function createConnection(node1, node2) {
            const svg = document.getElementById("connections");
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("data-nodes", `${node1.dataset.id}-${node2.dataset.id}`);
            updatePath(path, node1, node2);
            svg.appendChild(path);
        }

        function updatePath(path, node1, node2) {
            const x1 = node1.offsetLeft + node1.offsetWidth;
            const y1 = node1.offsetTop + node1.offsetHeight / 2;
            const x2 = node2.offsetLeft;
            const y2 = node2.offsetTop + node2.offsetHeight / 2;
            path.setAttribute("d", `M${x1},${y1} C${x1+50},${y1} ${x2-50},${y2} ${x2},${y2}`);
        }

        function updateAllConnections() {
            document.querySelectorAll("path").forEach(path => {
                const [id1, id2] = path.getAttribute("data-nodes").split("-");
                const node1 = document.querySelector(`.node[data-id="${id1}"]`);
                const node2 = document.querySelector(`.node[data-id="${id2}"]`);
                if (node1 && node2) {
                    updatePath(path, node1, node2);
                }
            });
        }
    </script>
</body>
</html>
